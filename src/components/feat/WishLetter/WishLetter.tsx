'use client';

import { motion,AnimatePresence  } from 'framer-motion';
import { useEffect, useState } from 'react';
import { X } from 'lucide-react';
import {clsx} from "clsx";

export default function WishLetter() {
    const [open, setOpen] = useState(false);
    const [typedText, setTypedText] = useState('');
    const [skip, setSkip] = useState(false);

    const fullText = `Happy birthday á€•á€«á€…á€­á€™á€ºá€¸á€›á€±á‹

á€¡á€á€»á€­á€”á€ºá€á€½á€± á€â€Œá€–á€¼á€Šá€ºá€¸á€–á€¼á€Šá€ºá€¸á€”á€²á€· á€€á€¯á€”á€ºá€œá€¬á€œá€­á€¯á€€á€ºá€á€¬ á€…á€­á€™á€ºá€¸á€á€±á€¬á€„á€º á‚áá€”á€¾á€…á€ºá€•á€¼á€Šá€·á€ºá€á€²á€·á€•á€¼á€®á€”á€±á€¬á€ºá‹á€¡á€á€€á€ºá€á€–á€¼á€Šá€ºá€¸á€–á€¼á€Šá€ºá€¸á€€á€¼á€®á€¸á€œá€¬á€á€¬á€”á€²á€·á€¡á€á€° á€…á€­á€™á€ºá€¸á€€á€œá€Šá€ºá€¸ á€á€–á€¼á€Šá€ºá€¸á€–á€¼á€Šá€ºá€¸á€”á€²á€· á€•á€­á€¯á€›á€„á€·á€ºá€€á€»á€€á€ºá€•á€¼á€®á€¸ á€•á€­á€¯á€œá€­á€™á€¹á€™á€¬á€œá€¬á€á€¬á€€á€­á€¯ á€€á€­á€¯á€€á€­á€¯á€€ á€¡á€á€­á€¡á€™á€¾á€á€ºá€•á€¼á€¯á€•á€«á€á€šá€ºá‹á€’á€®á€‘á€€á€ºá€•á€­á€¯á€•á€¼á€®á€¸á€œá€Šá€ºá€¸ á€›á€„á€·á€ºá€€á€»á€€á€ºá€•á€¼á€®á€¸á€á€±á€¬á€ºá€œá€¬á€¦á€¸á€™á€šá€ºá€œá€­á€¯á€· á€€á€­á€¯á€€á€­á€¯á€šá€¯á€¶á€•á€«á€á€šá€º á‹ (á€…á€­á€™á€ºá€¸á€€á€œá€Šá€ºá€¸á€€á€¼á€­á€¯á€¸á€…á€¬á€¸á€›á€™á€šá€ºá€”á€±á€¬á€º)

á€á€¯ á€…á€­á€™á€ºá€¸á€›á€²á€· á‚áá€”á€¾á€…á€ºá€•á€¼á€Šá€·á€ºá€™á€½á€±á€¸á€”á€±á€·á€™á€¾á€¬ á€™á€½á€±á€¸á€”á€±á€·á€†á€¯á€á€±á€¬á€„á€ºá€¸á€•á€±á€¸á€–á€­á€¯á€·áŠ á€¡á€™á€¾á€á€ºá€á€›á€–á€¼á€…á€ºá€–á€­á€¯á€·á€”á€²á€· á€…á€­á€™á€ºá€¸á€›á€„á€ºá€‘á€²á€™á€¾á€¬ á€€á€¼á€Šá€ºá€”á€°á€¸á€”á€¾á€…á€ºá€á€­á€™á€·á€ºá€™á€¾á€¯á€á€…á€ºá€…á€¯á€¶á€á€›á€¬á€›á€›á€¾á€­á€…á€±á€–á€­á€¯á€·á€¡á€á€½á€€á€º á€€á€­á€¯á€€á€­á€¯á€€ á€’á€®á€…á€¬á€€á€­á€¯áŠ á€’á€® website á€œá€±á€¸á€€á€­á€¯á€›á€±á€¸á€–á€¼á€…á€ºá€á€²á€·á€á€šá€ºá€•á€±á€«á€·á€œá€±á‹

á€¡á€…á€…á€¡á€›á€¬á€›á€¬á€•á€»á€€á€ºá€…á€®á€¸á€†á€½á€±á€¸á€™á€¼á€Šá€·á€ºá€•á€¼á€®á€¸ á€á€„á€½á€±á€·á€„á€½á€±á€·á€œá€±á€¬á€„á€ºá€™á€¼á€­á€¯á€€á€ºá€”á€±á€á€²á€· á€’á€®á€á€­á€¯á€„á€ºá€¸á€•á€¼á€Šá€ºá€€á€¼á€®á€¸á€‘á€²á€™á€¾á€¬ á€…á€­á€™á€ºá€¸á€á€…á€ºá€šá€±á€¬á€€á€º á€’á€á€ºá€›á€¬á€¡á€”á€¬á€á€›á€€á€„á€ºá€¸á€€á€„á€ºá€¸á€”á€²á€· á€•á€»á€±á€¬á€ºá€•á€»á€±á€¬á€ºá€›á€½á€¾á€„á€ºá€›á€½á€¾á€„á€º á€œá€½á€á€ºá€œá€½á€á€ºá€œá€•á€ºá€œá€•á€º á€”á€±á€”á€­á€¯á€„á€ºá€•á€«á€…á€±á€œá€­á€¯á€·á€€á€­á€¯á€€á€­á€¯á€€á€†á€¯á€á€±á€¬á€„á€ºá€¸á€•á€±á€¸á€•á€«á€á€šá€ºá‹
 á€’á€®á€á€±á€á€ºá€†á€­á€¯á€¸á€€á€¼á€®á€¸á€›á€²á€· á€›á€­á€¯á€€á€ºá€á€á€ºá€™á€¾á€¯á€á€½á€±á€€ á€”á€±á€œá€Šá€ºá€¸ á€€á€­á€¯á€€á€­á€¯á€á€­á€¯á€·á€”á€¾á€…á€ºá€šá€±á€¬á€€á€ºá€œá€¯á€¶á€¸â€Œá€›á€±á€¬( á€á€á€¼á€¬á€¸á€¡á€¬á€¸á€œá€¯á€¶á€¸á€›á€±á€¬) á€¡á€™á€¼á€”á€ºá€†á€¯á€¶á€¸á€€á€„á€ºá€¸á€œá€½á€á€ºá€›á€•á€«á€…á€±á‹ á€”á€±á€¬á€€á€º á€œá€­á€¯á€¡á€•á€ºá€á€¬á€‘á€€á€ºá€€á€­á€¯á€•á€­á€¯á€”á€±á€á€²á€·á€á€²á€· á€€á€­á€¯á€€á€­á€¯á€á€­á€¯á€·á€”á€¾á€…á€ºá€šá€±á€¬á€€á€ºá€€á€¼á€¬á€¸á€€ á€á€±á€¸á€€á€½á€¬á€›á€™á€¾á€¯á€á€½á€±áŠ á€œá€½á€™á€ºá€¸á€™á€±á€¬á€›á€™á€¾á€¯á€á€½á€±á€”á€²á€· á€¡á€á€€á€ºá€¡á€á€²á€á€½á€±á€œá€Šá€ºá€¸ á€¡á€™á€¼á€”á€ºá€†á€¯á€¶á€¸ á€€á€¯á€”á€ºá€†á€¯á€¶á€¸á€•á€«á€…á€± á€•á€±á€«á€·á€œá€±á‹
á€á€…á€ºá€šá€±á€¬á€€á€ºá€œá€€á€ºá€€á€­á€¯á€á€…á€ºá€šá€±á€¬á€€á€º á€…á€­á€á€ºá€€á€°á€¸á€”á€²á€· á€†á€¯á€•á€ºá€€á€­á€¯á€„á€ºá€‘á€¬á€¸á€›á€á€²á€· á€”á€±á€·á€›á€€á€ºá€á€½á€±á€œá€Šá€ºá€¸ á€¡á€™á€¼á€”á€ºâ€Œá€†á€¯á€¶á€¸ á€•á€¼á€®á€¸á€†á€¯á€¶á€¸á€•á€¼á€®á€¸ á€¡á€™á€¾á€á€ºá€á€›á€”á€±á€·á€›á€€á€ºá€á€½á€±á€á€­á€¯á€„á€ºá€¸á€€á€­á€¯ á€¡á€á€°á€á€°á€–á€¼á€á€ºá€á€”á€ºá€¸á€á€½á€„á€·á€ºá€›á€•á€«á€…á€±á€•á€±á€«á€·á‹ á€¡á€²á€·á€á€œá€­á€¯ á€€á€­á€¯á€€á€­á€¯á€€ á€†á€¯á€á€±á€¬á€„á€ºá€¸á€•á€«á€á€šá€ºá‹

á€¡á€€á€šá€ºá€œá€­á€¯á€·á€™á€»á€¬á€¸ á€’á€®á€€á€¼á€¬á€¸á€‘á€²á€™á€¾á€¬ á€…á€­á€™á€ºá€¸á€¡á€”á€±á€”á€²á€· á€˜á€šá€ºá€œá€­á€¯ á€…á€­á€á€ºá€Šá€…á€ºá€…á€›á€¬ á€˜á€šá€ºá€œá€­á€¯á€¡á€á€€á€ºá€¡á€á€²á€á€½á€±á€•á€² á€€á€¼á€¯á€¶á€›á€á€Šá€ºá€–á€¼á€…á€ºá€…á€±á€•á€±á€«á€·á€œá€±, á€†á€›á€¬á€…á€­á€¯á€„á€ºá€¸á€á€™á€ºá€¸á€œá€­á€á€ºá€›á€²á€·á€…á€¬á€á€¬á€¸á€œá€­á€¯ 
"á€™á€€á€¼á€±á€¬á€€á€ºá€…á€™á€ºá€¸á€”á€²á€· á€¡á€”á€¬á€¸á€™á€¾á€¬â€Œá€œá€±á€€á€­á€¯á€šá€º á€›á€¾á€­á€á€šá€º,
á€”á€±á€¬á€€á€ºá€™á€†á€¯á€á€ºá€”á€²á€· á€¡á€”á€¬á€¸á€™á€¾á€¬á€œá€± á€€á€­á€¯á€šá€ºá€›á€¾á€­á€á€šá€º"á€•á€±á€«á€·á‹
á€€á€­á€¯á€€á€­á€¯á€€ á€¡á€²á€·á€œá€­á€¯á€•á€¼á€±á€¬á€á€»á€„á€ºá€•á€«á€á€šá€ºá‹á€¡á€™á€¼á€²á€á€™á€ºá€¸á€™á€Ÿá€¯á€á€ºá€á€±á€¬á€„á€º á€…á€­á€™á€ºá€¸á€œá€­á€¯á€¡á€•á€ºá€á€²á€·á€¡á€á€»á€­á€”á€ºá€á€­á€¯á€„á€ºá€¸á€”á€®á€¸á€•á€«á€¸á€™á€¾á€¬ á€€á€­á€¯á€€á€­á€¯á€Ÿá€¬á€…á€­á€™á€ºá€¸á€¡á€”á€¬á€¸á€™á€¾á€¬ á€€á€­á€¯á€€á€­á€¯á€á€á€ºá€”á€­á€¯á€„á€ºá€á€²á€·á€•á€¯á€¶á€…á€¶á€á€…á€ºá€™á€»á€­á€¯á€¸á€™á€»á€­á€¯á€¸ á€”á€Šá€ºá€¸á€œá€™á€ºá€¸á€á€…á€ºá€™á€»á€­á€¯á€¸á€™á€»á€­á€¯á€¸ á€”á€²á€·á€›á€¾á€­á€”á€±á€•á€±á€¸á€”á€­á€¯á€„á€ºá€á€²á€·á€á€šá€ºá€œá€­á€¯á€·á€œá€Šá€ºá€¸ á€€á€­á€¯á€€á€­á€¯á€šá€¯á€¶á€•á€«á€á€šá€ºá‹

á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€¡á€”á€±á€”á€²á€· á€€á€­á€¯á€€á€­á€¯á€•á€¼á€±á€¬á€”á€±á€€á€¼á€œá€­á€¯á€•á€² á€á€…á€ºá€”á€±á€·á€”á€±á€·á€™á€¾á€¬á€á€±á€¬á€· á€€á€­á€¯á€€á€­á€¯á€á€­á€¯á€·á€á€½á€±á€Ÿá€¬ á€á€…á€ºá€šá€±á€¬á€€á€ºá€œá€€á€ºá€€á€­á€¯á€á€…á€ºá€šá€±á€¬á€€á€ºá€†á€¯á€•á€ºá€€á€­á€¯á€„á€ºá€‘á€¬á€¸á€›á€„á€ºá€¸ á€•á€„á€ºá€œá€šá€ºá€€á€­á€¯á€á€…á€ºá€šá€±á€¬á€€á€ºá€á€…á€ºá€á€€á€ºá€„á€±á€¸á€”á€±á€€á€¼á€›á€™á€¾á€¬á€•á€« á‹ á€¡á€²á€·á€’á€®á€á€…á€ºâ€Œá€”á€±á€·á€”á€±á€·á€†á€® á€€á€­á€¯ á€¡á€™á€¼á€”á€ºá€†á€¯á€¶á€¸á€›á€±á€¬á€€á€ºá€œá€¬á€–á€­á€¯á€·á€œá€Šá€ºá€¸á€€á€­á€¯á€€á€­á€¯á€á€­á€¯á€·á€€ á€¡á€á€°á€á€°á€€á€¼á€­á€¯á€¸á€…á€¬á€¸á€€á€¼á€•á€¼á€®á€¸ á€€á€­á€¯á€€á€­á€¯á€á€­á€¯á€·á€›á€²á€·á€€á€¼á€­á€¯á€¸á€…á€¬á€¸á€™á€¾á€¯á€á€½á€±á€¡á€™á€¼á€”á€ºá€†á€¯á€¶á€¸ á€¡á€›á€¬á€‘á€„á€ºá€œá€¬á€–á€­á€¯á€·á€¡á€á€½á€€á€º á€†á€¯á€á€±á€¬á€„á€ºá€¸á€›á€„á€ºá€¸...

á€•á€»á€±á€¬á€ºá€…á€›á€¬á€€á€±á€¬á€„á€ºá€¸á€•á€¼á€®á€¸ á€¡á€™á€¾á€á€ºá€á€›á€á€½á€±á€¡á€™á€»á€¬á€¸á€€á€¼á€®á€¸á€€á€»á€”á€ºá€”á€±á€™á€šá€ºá€· á€™á€½á€±á€¸á€”á€±á€·á€œá€±á€¸á€–á€¼á€…á€ºá€•á€«á€…á€±á€…á€­á€™á€ºá€¸á€›á€±á‹`;

    useEffect(() => {
        if (skip) {
            setTypedText(fullText);
            return;
        }

        if (!open) return;

        let i = 0;
        const interval = setInterval(() => {
            setTypedText((prev) => prev + fullText[i-1]);
            i++;
            if (i >= fullText.length) clearInterval(interval);
        }, 50);

        return () => clearInterval(interval);
    }, [open, skip, fullText]);

    const handleClose = () => {
        setOpen(false);
        setTypedText('');
        setSkip(false);
    };

    return (
        <div className="text-center w-[90vw]  flex justify-center ">
            <motion.article
                className={clsx("w-full max-w-md h-auto min-h-[50vh] sm:min-h-[85vh]  bg-white/90 backdrop-blur-sm rounded-3xl shadow-xl  flex flex-col justify-center items-center gap-6 sm:gap-8 relative overflow-hidden border-2 border-pink-100",open?"p-0":"p-6 sm:p-8")}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.6 }}
            >
                {!open && (
                    <motion.div
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        transition={{ delay: 0.8 }}
                    >
                        <h1 className="font-semibold font-romantic text-2xl text-center mb-6 text-pink-600">
                           Here is my wish for you, my little Sain.ğŸ’
                        </h1>
                        <motion.button
                            whileHover={{ scale: 1.05 }}
                            whileTap={{ scale: 0.95 }}
                            onClick={() => setOpen(true)}
                            className="px-6 py-3 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all"
                            aria-label="Open love letter"
                        >
                            Open Letter ğŸ’Œ
                        </motion.button>
                    </motion.div>
                )}

                <AnimatePresence>
                    {open && (
                        <motion.div
                            key="letter"
                            initial={{ opacity: 0, y: 50, scale: 0.8 }}
                            animate={{ opacity: 1, y: 0, scale: 1 }}
                            exit={{ opacity: 0, y: -50, scale: 0.8 }}
                            transition={{ duration: 0.6, type: 'spring' }}
                            className="relative w-full max-w-md h-auto bg-white/95 p-4 rounded-2xl shadow-lg border border-pink-100"
                            role="dialog"
                            aria-modal="true"
                            aria-label="Love letter"
                        >
                            <button
                                onClick={handleClose}
                                className="absolute top-4 right-4 text-gray-500 hover:text-pink-600 transition-colors"
                                aria-label="Close letter"
                            >
                                <X size={24} />
                            </button>

                            <div className="whitespace-pre-wrap text-pink-800 text-lg font-medium text-left min-h-[240px] md:min-h-[70vh] w-full p-4 overflow-y-auto">
                                {typedText}
                            </div>

                            <div className="flex justify-end">
                                {!skip && typedText.length < fullText.length && (
                                    <button
                                        onClick={() => setSkip(true)}
                                        className="mt-4 px-4 py-2 bg-pink-100 hover:bg-pink-200 text-pink-700 font-medium rounded-lg shadow-sm hover:shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-50 flex items-center gap-1"
                                    >
                                        Skip Typing
                                        <span className="text-lg">â©</span>
                                    </button>
                                )}
                            </div>
                        </motion.div>
                    )}
                </AnimatePresence>
            </motion.article>
        </div>
    );
}